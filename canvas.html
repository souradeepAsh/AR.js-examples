<!-- 
This is an HTML document that includes the A-Frame and A-Frame AR libraries, along with a custom script for updating a texture in real-time on an A-Frame entity.
The link tag is used to define a favicon, and the script tags are used to load the necessary A-Frame and A-Frame AR libraries.
The body tag contains a script tag that defines a custom component called canvas-texture. 
This component updates the texture of an A-Frame entity by drawing a rectangle on a canvas element (#myCanvas) and setting that canvas as the material for the entity.
Inside the canvas-texture component, there are two methods:
init: This method sets up the canvas and initializes variables for the animation.
tick: This method is called every frame and updates the position of the rectangle on the canvas, clears the canvas, and redraws the rectangle. 
It also signals that the texture needs to be updated.
The a-scene tag defines the scene and includes the following components:
embedded: This component specifies that the scene should be embedded in the HTML document.
vr-mode-ui: This component specifies that the VR mode UI should be enabled.
arjs: This component specifies that AR should be enabled and that the debug UI should be disabled.
Inside the a-assets tag, there is a canvas element with an ID of myCanvas. This canvas is used by the canvas-texture component to draw the rectangle.
Inside the a-marker tag, there is an a-box element that represents the A-Frame entity. 
This element has a position of (0, 0.5, 0) and a material that uses the #myCanvas canvas as its source. The canvas-texture component is also attached to this entity.
Finally, there is an a-entity tag that represents the camera. This is necessary for the AR experience. 
-->

<!doctype HTML>
<html>
<link rel="icon" href="data:;base64,iVBORw0KGgo=">
<script src="js/aframe.min.js"></script>
<script src="js/aframe-ar.js"></script>
<body style="margin: 0px; overflow: hidden;">

<script>

// attach this component to the up
AFRAME.registerComponent('canvas-texture', {

	init: function()
	{
		this.canvas = document.querySelector("#myCanvas");

		this.canvas.width = 512;
		this.canvas.height = 512;
		this.context = this.canvas.getContext('2d');
		
		this.x = 200;
		this.y = 100;
		this.dx = 5;
		this.dy = 3;
	},
	
	tick: function(t, dt)
	{
		this.x += this.dx;
		this.y += this.dy;
		
		let w = 50;
		let h = 50;

		if (this.x > 512-w || this.x < 0)
			this.dx *= -1;
		if (this.y > 512-h || this.y < 0)
			this.dy *= -1;
	
		// clear canvas
		this.context.fillStyle = "#8888FF";
		this.context.fillRect(0,0, 512,512);
		
		// draw rectangle
		this.context.fillStyle = "#FF0000";
		this.context.fillRect( this.x, this.y, w, h );

		// signal that image data needs to be updated
		let material = this.el.getObject3D("mesh").material;
		if (!material.map)
			return;
		else
			material.map.needsUpdate = true;
	}
});
</script>


<a-scene embedded vr-mode-ui="enabled: false;" arjs="debugUIEnabled: false;">

    <a-assets>
        <canvas id="myCanvas"></canvas>
	</a-assets>
    
    <a-marker type="pattern" url="data/kanji.patt">
        <a-box
               position="0 0.5 0" 
               material="src: #myCanvas; transparent: true; opacity: 0.95;"
               canvas-texture>
        </a-box>
    </a-marker>
    
    <a-entity camera></a-entity>
    
</a-scene>
</body>
</html>